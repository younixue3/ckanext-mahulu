{% set title = package.title or package.name %}
{% set notes = h.markdown_extract(package.notes, extract_length=180) %}

{% block package_item %}
<div class="group flex items-start gap-4 p-4 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow duration-200 {{ item_class or 'dataset-item' }}">
    <div class="flex-1 min-w-0">
        {% block content %}
            {% block heading %}
                <div class="flex items-center gap-2 mb-2">
                    <h2 class="text-lg font-semibold text-blue-900 truncate">
                        {% block heading_private %}
                            {% if package.private %}
                                <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md bg-blue-100 text-blue-700">
                                    {{ _('Private') }}
                                </span>
                            {% endif %}
                        {% endblock %}
                        {% block heading_title %}
                            <a class="text-blue-600 hover:text-blue-500" href="{{ h.url_for('%s.read' % package.type, id=package.name) }}">
                                {{ title|truncate(80) }}
                            </a>
                        {% endblock %}
                    </h2>
                    {% block heading_meta %}
                        {% if package.get('state', '').startswith('draft') %}
                            <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md bg-cyan-100 text-cyan-700">
                                {{ _('Draft') }}
                            </span>
                        {% elif package.get('state', '').startswith('deleted') %}
                            <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md bg-red-100 text-red-700">
                                {{ _('Deleted') }}
                            </span>
                        {% endif %}
                        {{ h.popular('recent views', package.tracking_summary.recent, min=10) if package.tracking_summary }}
                    {% endblock %}
                </div>
            {% endblock %}

            {% if package.organization %}
                <div class="mb-2">
                    <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md bg-blue-100 text-blue-700">
                        {{ package.organization.title }}
                    </span>
                </div>
            {% endif %}

            {% block notes %}
                {% if notes %}
                    <p class="text-sm text-blue-700 line-clamp-3">{{ notes|urlize }}</p>
                {% else %}
                    <p class="text-sm text-blue-400 italic">
                        {{ h.humanize_entity_type('package', package.type, 'no description') or _("There is no description for this dataset") }}
                    </p>
                {% endif %}
            {% endblock %}
        {% endblock %}
    </div>

    {% block resources %}
        {% if package.resources and not hide_resources %}
            {% block resources_outer %}
                <ul class="flex flex-wrap gap-2">
                    {% block resources_inner %}
                        {% for resource in h.dict_list_reduce(package.resources, 'format') %}
                            <li>
                                <a href="{{ h.url_for(package.type ~ '.read', id=package.name) }}"
                                   class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200">
                                    {{ resource }}
                                </a>
                            </li>
                        {% endfor %}
                    {% endblock %}
                </ul>
            {% endblock %}
        {% endif %}
    {% endblock %}
</div>
{% endblock %}