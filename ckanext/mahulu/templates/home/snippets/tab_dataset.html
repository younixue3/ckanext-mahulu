<div class="px-4 py-6">
  {% set dataset_list = h.get_sismut_infografik() %}
  {% set infografik_list = h.get_sismut_infografik() %}

  <h2 class="text-2xl font-bold text-gray-900 mb-4">Sorotan</h2>
  <div class="flex gap-2 mb-6">
    <button type="button" data-tab="dataset" class="tab-btn bg-indigo-800 text-white px-3 py-1.5 rounded-md font-medium">Dataset</button>
    <button type="button" data-tab="infografik" class="tab-btn bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md font-medium">Infografik</button>
  </div>

  <div id="tab-dataset" class="tab-panel block">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {% for package in dataset_list[:3] %}
        {% set item = h.mahulu_showing_dataset(package) %}
        <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300">
          <!-- Try to find a resource that is an image, otherwise use placeholder -->
          {% set image_url = '/images/placeholder-group.png' %}
          {% if item.resources %}
            {% for res in item.resources %}
               {% if res.format and res.format.lower() in ['png', 'jpg', 'jpeg', 'gif'] %}
                  {% set image_url = res.url %}
               {% endif %}
            {% endfor %}
          {% endif %}
          
          <div class="w-full h-36 md:h-44 bg-gray-100 flex items-center justify-center overflow-hidden">
             {% if image_url != '/images/placeholder-group.png' %}
                <img src="{{ image_url }}" alt="{{ item.title }}" class="w-full h-full object-cover">
             {% else %}
                <span class="text-gray-400 text-4xl font-bold">{{ item.title[:1] }}</span>
             {% endif %}
          </div>

          <div class="p-4">
            <h3 class="text-gray-900 font-semibold line-clamp-2">
                <a href="{{ h.url_for('dataset.read', id=item.name) }}" class="hover:text-indigo-600">
                    {{ item.title }}
                </a>
            </h3>
            <p class="text-gray-600 text-sm line-clamp-3 mt-2">{{ (item.notes | default('', true) | striptags) }}</p>
          </div>
        </div>
      {% endfor %}
      {% if not dataset_list %}
        <div class="col-span-3 text-center py-8 text-gray-500">Belum ada dataset yang tersedia.</div>
      {% endif %}
    </div>
  </div>

  <div id="tab-infografik" class="tab-panel hidden">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% for item in infografik_list %}
      <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300">
        {% set img_url = item.thumbnai or '' %}
        {# If thumbnail is empty but gallery exists, use first gallery item #}
        {% if not img_url and item.gallery and item.gallery|length > 0 %}
             {% set img_url = item.gallery[0].linkurl %}
        {% endif %}

        <div class="w-full h-48 md:h-64 bg-gray-100 flex items-center justify-center overflow-hidden relative group">
             {% if img_url %}
               <img src="{{ img_url }}" alt="{{ item.Judul }}" class="w-full h-full object-cover">
             {% else %}
               <span class="text-gray-400">No Image</span>
             {% endif %}
             
             {# Overlay for click action #}
             <a href="{{ item.url_sismut }}" target="_blank" class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></a>
        </div>

        <div class="p-4">
          <div class="flex items-center justify-between mb-2">
               <span class="text-xs font-medium text-indigo-600 bg-indigo-50 px-2 py-1 rounded">{{ item.Kategori }}</span>
               <span class="text-xs text-gray-500 flex items-center gap-1">
                   <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                   {{ item.Viewer }}
               </span>
          </div>
          <h3 class="text-gray-900 font-semibold text-lg line-clamp-2 mb-2">
              <a href="{{ item.url_sismut }}" target="_blank" class="hover:text-indigo-600 transition-colors">
                  {{ item.Judul }}
              </a>
          </h3>
          <p class="text-gray-600 text-sm line-clamp-3">{{ (item.Isi or '') | striptags }}</p>
          <div class="mt-4 pt-3 border-t border-gray-100 flex justify-between items-center text-xs text-gray-500">
               <span>{{ item.DisusunOleh }}</span>
          </div>
        </div>
      </div>
      {% endfor %}
      {% if not infografik_list %}
         <div class="col-span-2 text-center py-8 text-gray-500">Belum ada infografik yang tersedia.</div>
      {% endif %}
    </div>
  </div>

  <script>
    (function(){
      var btns = document.querySelectorAll('.tab-btn');
      var panels = {
        dataset: document.getElementById('tab-dataset'),
        infografik: document.getElementById('tab-infografik')
      };
      btns.forEach(function(b){
        b.addEventListener('click', function(){
          var t = b.getAttribute('data-tab');
          Object.keys(panels).forEach(function(k){
            panels[k].classList.toggle('hidden', k !== t);
            panels[k].classList.toggle('block', k === t);
          });
          btns.forEach(function(x){
            var active = x.getAttribute('data-tab') === t;
            x.classList.toggle('bg-indigo-800', active);
            x.classList.toggle('text-white', active);
            x.classList.toggle('bg-gray-100', !active);
            x.classList.toggle('text-gray-700', !active);
          });
        });
      });
    })();
  </script>
</div>
