<div class="px-4 py-6">
  {% set dataset_list = h.get_sismut_infografik() %}
  {% set infografik_list = h.get_sismut_infografik() %}

  <h2 class="text-2xl font-bold text-gray-900 mb-4">Sorotan</h2>
  <div class="flex gap-2 mb-6">
    <button type="button" data-tab="dataset" class="tab-btn bg-indigo-800 text-white px-3 py-1.5 rounded-md font-medium">Dataset</button>
    <button type="button" data-tab="infografik" class="tab-btn bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md font-medium">Infografik</button>
  </div>

  <div id="tab-dataset" class="tab-panel block">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {% for package in dataset_list[:3] %}
        {% set item = h.mahulu_showing_dataset(package) %}
        <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300">
          <!-- Try to find a resource that is an image, otherwise use placeholder -->
          {% set image_url = '/images/placeholder-group.png' %}
          {% if item.resources %}
            {% for res in item.resources %}
               {% if res.format and res.format.lower() in ['png', 'jpg', 'jpeg', 'gif'] %}
                  {% set image_url = res.url %}
               {% endif %}
            {% endfor %}
          {% endif %}
          
          <div class="w-full h-36 md:h-44 bg-gray-100 flex items-center justify-center overflow-hidden">
             {% if image_url != '/images/placeholder-group.png' %}
                <img src="{{ image_url }}" alt="{{ item.title }}" class="w-full h-full object-cover">
             {% else %}
                <span class="text-gray-400 text-4xl font-bold">{{ item.title[:1] }}</span>
             {% endif %}
          </div>

          <div class="p-4">
            <h3 class="text-gray-900 font-semibold line-clamp-2">
                <a href="{{ h.url_for('dataset.read', id=item.name) }}" class="hover:text-indigo-600">
                    {{ item.title }}
                </a>
            </h3>
            <p class="text-gray-600 text-sm line-clamp-3 mt-2">{{ (item.notes | default('', true) | striptags) }}</p>
          </div>
        </div>
      {% endfor %}
      {% if not dataset_list %}
        <div class="col-span-3 text-center py-8 text-gray-500">Belum ada dataset yang tersedia.</div>
      {% endif %}
    </div>
  </div>

  <div id="tab-infografik" class="tab-panel hidden">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% for item in infografik_list %}
      <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300">
        {% set img_url = item.image or item.file or item.url or '' %}
        {% if img_url and not img_url.startswith('http') %}
           {% set img_url = 'https://sismut.esistem.web.id/' ~ img_url.lstrip('/') %}
        {% endif %}
        
        <div class="w-full h-48 md:h-64 bg-gray-100 flex items-center justify-center overflow-hidden">
             {% if img_url %}
               <img src="{{ img_url }}" alt="{{ item.title or item.judul }}" class="w-full h-full object-contain">
             {% else %}
               <span class="text-gray-400">No Image</span>
             {% endif %}
        </div>

        <div class="p-4">
          <h3 class="text-gray-900 font-semibold">{{ item.title or item.judul or 'Infografik' }}</h3>
          <p class="text-gray-600 text-sm mt-2 line-clamp-3">{{ (item.description or item.keterangan or item.desc or '') | striptags }}</p>
        </div>
      </div>
      {% endfor %}
      {% if not infografik_list %}
         <div class="col-span-2 text-center py-8 text-gray-500">Belum ada infografik yang tersedia.</div>
      {% endif %}
    </div>
  </div>

  <script>
    (function(){
      var btns = document.querySelectorAll('.tab-btn');
      var panels = {
        dataset: document.getElementById('tab-dataset'),
        infografik: document.getElementById('tab-infografik')
      };
      btns.forEach(function(b){
        b.addEventListener('click', function(){
          var t = b.getAttribute('data-tab');
          Object.keys(panels).forEach(function(k){
            panels[k].classList.toggle('hidden', k !== t);
            panels[k].classList.toggle('block', k === t);
          });
          btns.forEach(function(x){
            var active = x.getAttribute('data-tab') === t;
            x.classList.toggle('bg-indigo-800', active);
            x.classList.toggle('text-white', active);
            x.classList.toggle('bg-gray-100', !active);
            x.classList.toggle('text-gray-700', !active);
          });
        });
      });
    })();
  </script>
</div>
